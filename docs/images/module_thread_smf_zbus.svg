<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="500" height="300" viewBox="0 0 500 300">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#000"/>
    </marker>
  </defs>

  <style>
    .outer-box { fill: #ffffff; stroke: #000000; stroke-width: 2; }
    .inner-box { fill: #ffffff; stroke: #000000; stroke-width: 1.5; }
    .func-box { fill: #ffffff; stroke: #000000; stroke-width: 1.5; }
    .title { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; }
    .label { font-family: Arial, sans-serif; font-size: 12px; }
    .code { font-family: monospace; font-size: 11px; }
    .arrow { stroke: #000000; stroke-width: 1.5; fill: none; marker-end: url(#arrowhead); }
  </style>

  <!-- Module Thread outer box -->
  <rect class="outer-box" x="20" y="20" width="460" height="260" rx="8"/>
  <text class="title" x="200" y="45">Module Thread</text>

  <!-- Message Processing Loop box -->
  <rect class="inner-box" x="40" y="60" width="420" height="200" rx="6"/>
  <text class="label" x="175" y="85">Message Processing Loop</text>

  <!-- zbus_sub_wait_msg box -->
  <rect class="func-box" x="150" y="100" width="180" height="40" rx="4"/>
  <text class="code" x="175" y="125">zbus_sub_wait_msg()</text>

  <!-- Arrow from zbus to smf -->
  <line class="arrow" x1="240" y1="140" x2="240" y2="195"/>
  <text class="label" x="250" y="172">New Message</text>

  <!-- smf_run_state box -->
  <rect class="func-box" x="170" y="200" width="140" height="40" rx="4"/>
  <text class="code" x="190" y="225">smf_run_state()</text>

  <!-- Arrow looping back from smf_run_state to zbus_sub_wait_msg -->
  <path class="arrow" d="M 310 220 L 390 220 L 390 120 L 335 120"/>

</svg>
